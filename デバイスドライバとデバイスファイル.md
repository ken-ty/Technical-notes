# デバイスドライバとデバイスファイル
## 説明  
デバイスドライバは、読み込まれるとOSの一部となり、OSにデバイスを認識させ、制御可能にします。

また、デバイスファイルはデバイスドライバのインターフェースです。
ユーザーは、デバイスファイルを通してデバイスを操作します。
デバイスファイルは通常/dev/下に配置されます。

## 仕組み
### デバイスドライバの中身  
デバイスドライバの実態はカーネルモジュールです。
具体的には、デバイスドライバは、カーネルに用意されたデバイスドライバ用の仕組みに乗っかっています。
その仕組みの1つとして、カーネルモジュールをロードした時はデバイスドライバプログラムのmodule_init()を実行、
アンロードした時は、module_exit()を実行することになっています。
これを使用しなくてもビルド・ロードは通りますが、これらが定義されてないとドライバを検知できません。

デバイスファイルを読み書きした時の挙動も、同様に決められた関数で定義してあげます。
これらの関数は、必要な時にカーネルに呼び出されます(カーネルモジュールなので)。

また、各種システムコールに対応するには、ハンドラテーブルを作成します。
これをしないと、Ctrl+Cで終了や、Ctrl+zで一時停止などができません。

こうしてできたデバイスドライバを、動作中のカーネルにビルドしてロードします。

### デバイスファイルの作成
デバイスドライバが正常に動作したら、次は/dev/下にデバイスファイルを作成します。
mknodでパスを指定してデバイスファイルを作成します。
また、アクセス権も指定します。

これで、一般ユーザーがデバイスをデバイスファイルから操作することができるようになります。

## ほか
### メモ
* デバイスドライバはカーネルモジュール=メモリ上で動作するため、非常に高速に動作します。
* 追記: Linuxカーネルとは別のモジュールとして構築することもできます。
* 追記: Windowsのデバイスドライバの拡張子は".sys"です。(Linuxカーネルモジュールなら.koです)

### 参考
https://qiita.com/iwatake2222/items/1fdd2e0faaaa868a2db2  
http://public2016.hatenablog.com/entry/2016/09/01/231611  

## このメモについて  
大いに間違っている可能性があります。
コメント大歓迎です。
