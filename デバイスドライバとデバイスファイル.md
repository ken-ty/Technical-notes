# デバイスドライバとデバイスファイル
## 説明  
デバイスドライバは、読み込まれるとOSの一部となり、OSにデバイスを認識させ、制御可能にします。
また、デバイスファイルはデバイスドライバのインターフェースです。
ユーザーは、デバイスファイルを通してデバイスを操作します。
デバイスファイルは通常/dev/下に配置されます。

## 仕組み
### デバイスドライバの中身  
デバイスドライバの実態はカーネルモジュールです。このプログラム内で、カーネルに自身を登録します。
登録には、例えばキャラクタ型デバイスであれば、ロード時に呼ばれる関数内でregister_chrdev()を宣言します。
デバイスファイルを読み書きした時の挙動も、プログラム内に関数を作成して定義してあげます。
これらの関数は、ハードウェアの割り込みによって呼び出されて実行されると思います(推測です)。
また、各種システムコールに対応するには、ハンドラテーブルを作成します。
こうしてできたデバイスドライバを、動作中のカーネルにビルドしてロードします。

### デバイスファイルの作成
デバイスドライバが正常に動作したら、次は/dev/下にデバイスファイルを作成します。
mknodでパスを指定してデバイスファイルを作成します。
また、アクセス権も指定します。

これで、一般ユーザーがデバイスをデバイスファイルから操作することができるようになります。

## ほか
### メモ
デバイスドライバはカーネルモジュール=メモリ上で動作するため、非常に高速に動作します。
追記: Linuxカーネルとは別のモジュールとして構築することもできるそうです。
追記: Windowsのデバイスドライバの拡張子は".sys"だそうです。(Linuxカーネルモジュールなら.ko)。

### 参考
https://qiita.com/iwatake2222/items/1fdd2e0faaaa868a2db2  

## このメモについて  
大いに間違っている可能性があります。
コメント大歓迎です。
